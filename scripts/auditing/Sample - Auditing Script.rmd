---
title: "sample_audit_v1"
output: github_document
---

## Second script to run in a series of three that prepare the RTCI sample for production.
## This script takes the processed data and audits for non-reporting and anomalies.
bring in the sample
```{r}

```

```{r}
```

```{r}


unique_df <- combined_df %>%
  select(city_state) %>%
  distinct()


df1<- as.data.frame(unique(combined_df$city_state))
df2<- as.data.frame(unique(combined_df$city_state))


unique(combined_df$city_state)
unique(combined_df$city_state)

merged_df <- full_join(df1, df2, by = "")

# Print the merged data frame
print("Merged Data Frame:")
print(merged_df)

# Find records without a match in df1
unmatched_in_df1 <- anti_join(df2, df1, by = "city_state")
print("Records in df2 without a match in df1:")
print(unmatched_in_df1)

# Find records without a match in df2
unmatched_in_df2 <- anti_join(df1, df2, by = "city_state")
print("Records in df1 without a match in df2:")
print(unmatched_in_df2)
```


find all months with 0 larcenies
```{r}
theft_zero <- df_mvs_12mo %>%
  filter(Theft == 0)

murd_over_theft <- df_mvs_12mo %>%
  filter(Murder > Theft)

  

##some non-reportes from OH and MA expected
##tracy,ca; beaverton, or the review
```





AUDITING
```{r}
get_column_names_and_formats <- function(df_list) {
  # Extract column names and formats from each data frame
  column_list <- lapply(df_list, function(df) {
    colnames <- colnames(df)
    formats <- sapply(df, class)
    data.frame(ColumnName = colnames, Format = formats, stringsAsFactors = FALSE)
  })
  
  # Combine the column name and format information into a single data frame
  col_df <- do.call(rbind, lapply(seq_along(column_list), function(i) {
    df <- column_list[[i]]
    df$DataFrame <- names(df_list)[i]
    df
  }))
  
  return(col_df)
}

# Function to identify rarely used columns
identify_rare_columns <- function(col_df, threshold = 1) {
  # Count the frequency of each column name
  col_count <- col_df %>%
    group_by(ColumnName) %>%
    summarize(Frequency = n()) %>%
    arrange(Frequency)
  
  # Identify columns used in fewer data frames than the threshold
  rare_columns <- col_count %>%
    filter(Frequency <= threshold)
  
  return(rare_columns)
}

```



```{r}
# Get column names from each data frame
col_df <- get_column_names_and_formats(ldf2)

# Print the breakdown of column names
print(col_df)
```
```{r}
# Identify rarely used columns (e.g., used in 1 or fewer data frames)
rare_columns <- identify_rare_columns(col_df, threshold = 1)

# Print the rarely used columns
print(rare_columns)
```

duplicates?
```{r}
# Function to find unique values for "Agency Name" in a dataframe
get_unique_agencies <- function(df) {
  unique(df$`Agency Name`)
}

# Find unique values for "Agency Name" in all dataframes
unique_agencies_list <- lapply(ldf3, get_unique_agencies)

# Combine all unique values into a single vector
all_unique_agencies <- unlist(unique_agencies_list)

# Find duplicate agency names across all dataframes
duplicate_agencies <- all_unique_agencies[duplicated(all_unique_agencies)]

# View the unique agency names
print("Unique Agency Names Across All Dataframes")
print(unique(all_unique_agencies))

# View the duplicate agency names
print("Duplicate Agency Names Across All Dataframes")
print(duplicate_agencies)
```
what are we kicking when we rowbind?
```{r}
# Function to extract unique values from 'Agency.Name' column in each dataframe
extract_unique_agencies <- function(df_list, column_name) {
  unique_values <- df_list %>%
    map(~ .x %>% pull(.data[[column_name]])) %>%
    unlist() %>%
    unique()
  
  return(unique_values)
}

# Extract unique 'Agency.Name' values from the list of dataframes
unique_agencies <- extract_unique_agencies(ldf3, "Agency Name")

# Create a dataframe with these unique values
df1 <- as.data.frame(unique(unique_agencies))


# Count occurrences of values in the 'name' column for both dataframes
counts_df1 <- as.data.frame(table(df1$name))
counts_df2 <- as.data.frame(table(df2$name))

# Rename columns for clarity
colnames(counts_df1) <- c("name", "count_df1")
colnames(counts_df2) <- c("name", "count_df2")

# Merge the two count dataframes by the 'name' column
comparison <- merge(counts_df1, counts_df2, by = "name", all = TRUE)

# Replace NA values with 0 (if a name is not found in one of the dataframes)
comparison[is.na(comparison)] <- 0

# View the comparison
print("Comparison of Value Counts in 'name' Column Across Two Dataframes")
print(comparison)


# Function to extract unique values from a column and save as a vector
extract_unique_values <- function(df, column_name) {
  unique_values <- df %>% pull(.data[[column_name]]) %>% unique()
  return(unique_values)
}

# Extract unique values from 'Agency.Name' column in both dataframes
unique_values_df1 <- extract_unique_values(df1, "Agency.Name")
unique_values_df2 <- extract_unique_values(combined_df, "Agency Name")

# Compare the unique values between the two vectors
only_in_df1 <- setdiff(unique_values_df1, unique_values_df2)
only_in_df2 <- setdiff(unique_values_df2, unique_values_df1)
in_both <- intersect(unique_values_df1, unique_values_df2)

# Print the comparison results
cat("Unique values only in df1:\n")
print(only_in_df1)
cat("\nUnique values only in df2:\n")
print(only_in_df2)
cat("\nUnique values in both df1 and df2:\n")
print(in_both)

```

